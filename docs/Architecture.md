# System Architecture

## 1. Introduction

The Smart Tourist Safety System is designed with a microservices-oriented architecture. This approach enhances scalability, maintainability, and flexibility. The system comprises five core components: a blockchain-based identity module, a backend service, a mobile application, a web dashboard, and a database.

## 2. Core Components

### 2.1. Blockchain (Digital Identity)
- **Technology**: Solidity, Hardhat, Polygon Mumbai Testnet.
- **Purpose**: Provides a decentralized, tamper-proof system for managing tourist identities. The `DigitalTouristID` smart contract stores a hash of tourist information, not the raw data, to ensure privacy.
- **Key Functions**:
    - `registerTourist`: Allows an admin to register a new tourist, storing a hash of their details and an expiry date.
    - `revokeTourist`: Allows an admin to revoke a tourist's digital ID in case of an incident or at the end of their trip.
    - `verifyTourist`: A public function to verify the validity of a tourist ID against the on-chain data.

### 2.2. Backend (API & Business Logic)
- **Technology**: Node.js, Express.js, MongoDB, Mongoose, Socket.IO.
- **Purpose**: Acts as the central nervous system of the application. It handles business logic, data processing, and communication between the mobile app, dashboard, and blockchain.
- **Key Features**:
    - **RESTful API**: Exposes endpoints for authentication, data management, and emergency services.
    - **WebSocket Communication**: Uses Socket.IO for real-time updates, such as pushing live location data to the dashboard and sending alerts.
    - **Blockchain Interaction**: Communicates with the `DigitalTouristID` smart contract to register and verify tourists.
    - **Geofencing & AI Monitoring**: Contains logic to process location data, check against geofences, and run anomaly detection algorithms.
    - **Authentication**: Manages user authentication and authorization using JSON Web Tokens (JWT).

### 2.3. Mobile App (Tourist Interface)
- **Technology**: React Native.
- **Purpose**: The primary interface for tourists. It provides safety features and allows them to manage their digital ID.
- **Key Features**:
    - **Location Tracking**: Continuously sends the user's GPS coordinates to the backend.
    - **Panic Button**: A one-tap button to trigger an emergency alert.
    - **Geofence Alerts**: Receives and displays notifications from the backend about safe zones or restricted areas.
    - **Profile Management**: Allows tourists to view their digital ID status and itinerary.
    - **Multilingual Support**: Provides UI in both English and Hindi.

### 2.4. Web Dashboard (Monitoring & Response)
- **Technology**: React.js, Material-UI, React-Leaflet.
- **Purpose**: The interface for safety authorities or monitoring teams.
- **Key Features**:
    - **Real-time Map**: Displays the live location of all active tourists on an interactive map.
    - **Alerts Panel**: Shows incoming alerts (panic, geofence, AI-detected) in real-time.
    - **Incident Management**: Allows operators to create, view, and manage incident reports.
    - **Tourist Management**: Provides tools to search for tourists, view their details, and manage their status.
    - **Analytics**: Visualizes data through charts and reports.

### 2.5. Database
- **Technology**: MongoDB (primary), PostgreSQL (optional/supplementary).
- **Purpose**: Persists application data.
- **Data Models**:
    - **Tourists**: Stores detailed tourist information, including personal data (encrypted), itinerary, emergency contacts, and a reference to their blockchain ID.
    - **Alerts**: Logs all alerts generated by the system, including type, location, timestamp, and status.
    - **Incidents**: Stores detailed reports of incidents, including actions taken and resolution.

## 3. Data Flow

### Emergency Scenario (Panic Button)
1. **Tourist**: Taps the panic button in the mobile app.
2. **Mobile App**: Sends an API request with the tourist's ID and current location to `/api/emergency/panic`.
3. **Backend**:
    - Receives the request and validates the tourist's JWT.
    - Creates an `Alert` document in MongoDB.
    - Emits a `new-alert` event via Socket.IO to all connected dashboard clients.
4. **Dashboard**:
    - Receives the `new-alert` event.
    - Displays a high-priority notification and highlights the tourist on the map.
    - The monitoring team can then initiate the incident response protocol.

## 4. Security
- **Data Encryption**: Sensitive tourist data is encrypted at rest in the database. Passwords are hashed using bcrypt.
- **Authentication**: JWT is used to secure API endpoints.
- **Input Validation**: All incoming data is validated and sanitized to prevent injection attacks.
- **Blockchain Privacy**: Only a hash of tourist data is stored on the blockchain, preserving privacy.
- **Secure Communication**: HTTPS and WSS are used for all client-server communication.
